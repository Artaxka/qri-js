/*! qrijs 2015-05-26 */
!function(){!function(a){"use strict";function b(){this.data={}}function c(){this.listeners=new b}function d(a){setTimeout(function(){throw a},0)}function e(a){this.type=a,this.target=void 0}function f(a,b){e.call(this,a),this.data=b.data,this.lastEventId=b.lastEventId}function g(a,b){var c=a;return c!==c&&(c=b),z>c?z:c>A?A:c}function h(a,b,c){try{"function"==typeof b&&b.call(a,c)}catch(e){d(e)}}function i(b,d){function i(){M=s,void 0!=I&&(I.abort(),I=void 0),0!==J&&(clearTimeout(J),J=0),0!==K&&(clearTimeout(K),K=0),F.readyState=s}function j(a){var c=M===r||M===q?I.responseText:"",d=void 0,j=!1;if(M===q){var k=0,l="",m=void 0;if(n)try{k=I.status,l=I.statusText,m=I.getResponseHeader("Content-Type")}catch(o){k=0,l="",m=void 0}else""!==a&&"error"!==a&&(k=200,l="OK",m=I.contentType);if(void 0==m&&(m=""),0===k&&""===l&&"load"===a&&""!==c&&(k=200,l="OK",""===m)){var z=/^data\:([^,]*?)(?:;base64)?,[\S]*$/.exec(b);void 0!=z&&(m=z[1])}if(200===k&&y.test(m)){if(M=r,H=!0,G=C,F.readyState=r,d=new e("open"),F.dispatchEvent(d),h(F,F.onopen,d),M===s)return}else if(0!==k&&(200!==k||""!==m)){var B="";B=200!==k?"EventSource's response has a status "+k+" "+l.replace(/\s+/g," ")+" that is not 200. Aborting the connection.":"EventSource's response has a Content-Type specifying an unsupported type: "+m.replace(/\s+/g," ")+". Aborting the connection.",setTimeout(function(){throw new Error(B)},0),j=!0}}if(M===r){c.length>L&&(H=!0);for(var K=L-1,U=c.length,V="\n";++K<U;)if(V=c.charAt(K),R===t&&"\n"===V)R=u;else if(R===t&&(R=u),"\r"===V||"\n"===V){if("data"===S?N.push(T):"id"===S?O=T:"event"===S?P=T:"retry"===S?(C=g(Number(T),C),G=C):"heartbeatTimeout"===S&&(D=g(Number(T),D),0!==J&&(clearTimeout(J),J=setTimeout(Q,D))),T="",S="",R===u){if(0!==N.length&&(E=O,""===P&&(P="message"),d=new f(P,{data:N.join("\n"),lastEventId:O}),F.dispatchEvent(d),"message"===P&&h(F,F.onmessage,d),M===s))return;N.length=0,P=""}R="\r"===V?t:u}else R===u&&(R=v),R===v?":"===V?R=w:S+=V:R===w?(" "!==V&&(T+=V),R=x):R===x&&(T+=V);L=U}M!==r&&M!==q||!("load"===a||"error"===a||j||L>1048576||0===J&&!H)?0===J&&(H=!1,J=setTimeout(Q,D)):(j?i():(""!==a||0!==J||H||setTimeout(function(){throw new Error("No activity within "+D+" milliseconds. Reconnecting.")},0),M=p,I.abort(),0!==J&&(clearTimeout(J),J=0),G>16*C&&(G=16*C),G>A&&(G=A),J=setTimeout(Q,G),G=2*G+1,F.readyState=q),d=new e("error"),F.dispatchEvent(d),h(F,F.onerror,d))}function k(){j("progress")}function l(){j("load")}function z(){j("error")}b=b.toString();var B=m&&void 0!=d&&Boolean(d.withCredentials),C=g(1e3,0),D=g(45e3,0),E="",F=this,G=C,H=!1,I=void 0!=d&&void 0!=d.Transport?new d.Transport:new o,J=0,K=0,L=0,M=p,N=[],O="",P="",Q=void 0,R=u,S="",T="";n&&void 0!=a.opera&&(K=setTimeout(function U(){3===I.readyState&&j("progress"),K=setTimeout(U,500)},0)),Q=function(){if(J=0,M!==p)return void j("");if(n&&!("onloadend"in I)&&void 0!=a.document&&void 0!=a.document.readyState&&"complete"!==a.document.readyState)return void(J=setTimeout(Q,4));I.onload=l,I.onerror=z,n&&(I.onabort=z,I.onreadystatechange=k),void 0==I.sendAsBinary&&(I.onprogress=k),H=!1,J=setTimeout(Q,D),L=0,M=q,N.length=0,P="",O=E,T="",S="",R=u;var c=b.slice(0,5);c="data:"!==c&&"blob:"!==c?b+((-1===b.indexOf("?",0)?"?":"&")+"lastEventId="+encodeURIComponent(E)+"&r="+(Math.random()+1).toString().slice(2)):b,I.open("GET",c,!0),n&&(I.withCredentials=B,I.responseType="text",I.setRequestHeader("Accept","text/event-stream")),I.send(void 0)},c.call(this),this.close=i,this.url=b,this.readyState=q,this.withCredentials=B,this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,Q()}function j(){this.CONNECTING=q,this.OPEN=r,this.CLOSED=s}b.prototype.get=function(a){return this.data[a+"~"]},b.prototype.set=function(a,b){this.data[a+"~"]=b},b.prototype["delete"]=function(a){delete this.data[a+"~"]},c.prototype.dispatchEvent=function(a){a.target=this;var b=a.type.toString(),c=this.listeners,e=c.get(b);if(void 0!=e)for(var f=e.length,g=-1,h=void 0;++g<f;){h=e[g];try{h.call(this,a)}catch(i){d(i)}}},c.prototype.addEventListener=function(a,b){a=a.toString();var c=this.listeners,d=c.get(a);void 0==d&&(d=[],c.set(a,d));for(var e=d.length;--e>=0;)if(d[e]===b)return;d.push(b)},c.prototype.removeEventListener=function(a,b){a=a.toString();var c=this.listeners,d=c.get(a);if(void 0!=d){for(var e=d.length,f=[],g=-1;++g<e;)d[g]!==b&&f.push(d[g]);0===f.length?c["delete"](a):c.set(a,f)}},f.prototype=e.prototype;var k=a.XMLHttpRequest,l=a.XDomainRequest,m=void 0!=k&&void 0!=(new k).withCredentials,n=m,o=m?k:void 0!=l?l:void 0,p=-1,q=0,r=1,s=2,t=3,u=4,v=5,w=6,x=7,y=/^text\/event\-stream;?(\s*charset\=utf\-8)?$/i,z=1e3,A=18e6;j.prototype=c.prototype,i.prototype=new j,j.call(i);var B=function(){if(void 0!=a.EventSource)try{var b=new a.EventSource("data:text/event-stream;charset=utf-8,");return b.close(),b.withCredentials===!1&&""!==b.url}catch(c){return!1}return!1};void 0==o||B()||(a.NativeEventSource=a.EventSource,a.EventSource=i)}(this),function(){var a,b,c,d,e,f=[].slice;a=3,b={peer:null,checksum:null,address:null,onError:function(a){return a.srcElement.close()}},e=function(){var a;return a=1<=arguments.length?f.call(arguments,0):[],"undefined"!=typeof console&&null!==console?console.warn.apply(console,["[WARN]:"].concat(f.call(a))):void 0},c=function(a,b,c){var d;return d=new EventSource(a),d.onerror=c,d.onmessage=b},d=function(b){var c,d,e;return e={},d=b.data,c=parseInt(d.slice(0,a),10),c>=0?(e.msg=d.slice(a),e.code=c):e.msg=d,e},window.Qri=function(){function a(a,g){var h,i,j,k,l,m,n;return j=new QriLib,g=j.merge(b,g||{}),l=g.peer,i=g.checksum,h=g.address,k=g.onError,h?l?i?(m=j.makeUrl(h,{p:l.toString(),s:i.toString()}),n=function(){var b;return b=1<=arguments.length?f.call(arguments,0):[],a(d.apply(null,b))},void c(m,n,k)):e("checksum isnt specified. SSE is down."):e("peer isnt specified. SSE is down."):e("address isnt specified. SSE is down.")}return a}()}.call(this),function(){var a={}.hasOwnProperty;window.QriLib=function(){function b(){}return b.prototype.copy=function(b){var c,d,e;d=new Object;for(c in b)a.call(b,c)&&(e=b[c],d[c]=e);return d},b.prototype.merge=function(b,c){var d,e,f;e=this.copy(b);for(d in c)a.call(c,d)&&(f=c[d],e[d]=f);return e},b.prototype.makeUrl=function(b,c){var d,e,f;return e=function(){var b;b=[];for(d in c)a.call(c,d)&&(f=c[d],b.push([d+"="+f]));return b}(),b+"?"+e.join("&")},b}()}.call(this)}();